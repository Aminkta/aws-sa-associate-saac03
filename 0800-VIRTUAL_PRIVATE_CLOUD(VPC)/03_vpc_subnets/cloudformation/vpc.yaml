Description:  This template deploys the VPC with private subnets

Parameters:
  VpcName:
    Description: An environment name that is prefixed to resource names
    Type: String

  VpcCIDR:
    Description: Please enter the IP range (CIDR notation) for this VPC
    Type: String

  PrivateSubnet1Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet1CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PrivateSubnet2Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet2CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet 
    Type: String

  PrivateSubnet3Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet3CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PublicSubnet4Name:
    Description: Subnet Name
    Type: String

  PublicSubnet4CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PrivateSubnet5Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet5CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PrivateSubnet6Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet6CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PrivateSubnet7Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet7CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PublicSubnet8Name:
    Description: Subnet Name
    Type: String

  PublicSubnet8CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PrivateSubnet9Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet9CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PrivateSubnet10Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet10CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PrivateSubnet11Name:
    Description: Subnet Name
    Type: String

  PrivateSubnet11CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String

  PublicSubnet12Name:
    Description: Subnet Name
    Type: String

  PublicSubnet12CIDR:
    Description: Please enter the IP range (CIDR notation) for the private subnet
    Type: String
  
  RouteTableVpc1Name:
    Description: Please Enter Route Table name
    Type: String

Resources:
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: !Ref VpcCIDR
      EnableDnsSupport: true
      EnableDnsHostnames: true
      Tags:
        - Key: Name
          Value: !Ref VpcName

  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: !Ref VpcName

  InternetGatewayAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      InternetGatewayId: !Ref InternetGateway
      VpcId: !Ref VPC

  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC
      Tags:
        - Key: Name
          Value: !Ref RouteTableVpc1Name

  DefaultPublicRouteIpv4:
    Type: AWS::EC2::Route
    DependsOn: InternetGatewayAttachment
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway

  DefaultPublicRouteIpv6:
    Type: AWS::EC2::Route
    DependsOn: InternetGatewayAttachment
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationIpv6CidrBlock: "::/0"
      GatewayId: !Ref InternetGateway

  IPv6CidrBlock:
    Type: AWS::EC2::VPCCidrBlock
    Properties:
      VpcId: !Ref VPC
      AmazonProvidedIpv6CidrBlock: true

  PrivateSubnet1:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock: 
        !Select
          - 0
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 0, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet1CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet1Name

  PrivateSubnet2:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 1
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 0, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet2CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet2Name

  PrivateSubnet3:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 2
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 0, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet3CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet3Name

  PublicSubnet4:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 3
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 0, !GetAZs  '' ]
      CidrBlock: !Ref PublicSubnet4CIDR
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Ref PublicSubnet4Name

  PublicSubnet4RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !Ref PublicSubnet4

  PrivateSubnet5:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 4
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet5CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet5Name

  PrivateSubnet6:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 5
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet6CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet6Name

  PrivateSubnet7:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 6
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet7CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet7Name

  PublicSubnet8:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 7
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PublicSubnet8CIDR
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Ref PublicSubnet8Name

  PublicSubnet8RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !Ref PublicSubnet8

  PrivateSubnet9:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 8
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet9CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet9Name

  PrivateSubnet10:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 9
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet10CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet10Name

  PrivateSubnet11:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 10
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSubnet11CIDR
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Ref PrivateSubnet11Name

  PublicSubnet12:
    Type: AWS::EC2::Subnet
    DependsOn: IPv6CidrBlock
    Properties:
      VpcId: !Ref VPC
      AssignIpv6AddressOnCreation: true
      Ipv6CidrBlock:
        !Select
          - 11
          - Fn::Cidr:
            - !Select [ 0, !GetAtt VPC.Ipv6CidrBlocks]
            - 256
            - 64
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PublicSubnet12CIDR
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Ref PublicSubnet12Name


  PublicSubnet12RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !Ref PublicSubnet12

Outputs:
  VPC:
    Description: A reference to the created VPC
    Value: !Ref VPC

  PrivateSubnets:
    Description: A list of the private subnets
    Value: !Join [ ",", [ !Ref PrivateSubnet1, !Ref PrivateSubnet2, !Ref PrivateSubnet3, !Ref PublicSubnet4 ]]

  PrivateSubnet1:
    Description: A reference to the private subnet in the 1st Availability Zone
    Value: !Ref PrivateSubnet1

  PrivateSubnet2:
    Description: A reference to the private subnet in the 1st Availability Zone
    Value: !Ref PrivateSubnet2

  PrivateSubnet3:
    Description: A reference to the private subnet in the 1st Availability Zone
    Value: !Ref PrivateSubnet3

  PublicSubnet4:
    Description: A reference to the private subnet in the 1st Availability Zone
    Value: !Ref PublicSubnet4

  PrivateSubnet5:
    Description: A reference to the private subnet in the 2nd Availability Zone
    Value: !Ref PrivateSubnet5

  PrivateSubnet6:
    Description: A reference to the private subnet in the 2nd Availability Zone
    Value: !Ref PrivateSubnet6

  PrivateSubnet7:
    Description: A reference to the private subnet in the 2nd Availability Zone
    Value: !Ref PrivateSubnet7

  PublicSubnet8:
    Description: A reference to the private subnet in the 2nd Availability Zone
    Value: !Ref PublicSubnet8

  PrivateSubnet9:
    Description: A reference to the private subnet in the 3rd Availability Zone
    Value: !Ref PrivateSubnet9

  PrivateSubnet10:
    Description: A reference to the private subnet in the 3rd Availability Zone
    Value: !Ref PrivateSubnet10

  PrivateSubnet11:
    Description: A reference to the private subnet in the 3rd Availability Zone
    Value: !Ref PrivateSubnet11

  PublicSubnet12:
    Description: A reference to the private subnet in the 3rd Availability Zone
    Value: !Ref PublicSubnet12

